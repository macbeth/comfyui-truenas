# comfyui-truenas
Minimal Docker image of ComfyUI for Truenas, based on nVidia official base cuda images with:

  ["ComfyUI-Manager"]="https://github.com/ltdrdata/ComfyUI-Manager.git"
  
  ["ComfyUI-Crystools"]="https://github.com/crystian/ComfyUI-Crystools.git"

## last update 25 07 2025

## GPU Support
Only nVidia cards that support CUDA 12.4.
If you need, it's probably possible realize an image for othe GPU aswell starting from base image of AMD instead of Nvidia.
Drop me a message and I'll see what i can do.

## Install 

use the image

tommasopiantanida/comfyui-truenas:latest

for last stable version working with current Truenas version

composer file something like:

```
name: comfyui
services:
  comfyui:
    container_name: comfyui-truenas
    deploy:
      resources:
        reservations:
          devices:
            - capabilities:
                - gpu
              count: all
              driver: nvidia
    environment:
      - UID=1000
      - GID=1000
      - PORT=8188
    image: tommasopiantanida/comfyui-truenas:test
    ports:
      - '8188:8188'
    privileged: True
    volumes:
     - /hostpath/models:/app/ComfyUI/models
     - /hostpath/custom_nodes:/app/ComfyUI/custom_nodes
     - /hostpath/input:/app/ComfyUI/input
     - /hostpath/output:/app/ComfyUI/output
     - /hostpath/user:/app/ComfyUI/user

```
After the launch of the container you can access ComfyUI at the ip address of truenas: http://truenas:8188

## ENVIRONMENT VARIABLES

| ENV                                  | Default | Description                    |
| :----------------                    |  ------:|:--------------------           |
| UID                                  |   1000  | User Id                        |
| GUID                                 |   1000  | Group Id of User Id            |
| port                                 |   8188  | Port of the web GUI of ComfyUI |
| EXTRA COMFYUI ARGUMENTS              |   none  | specify any argument with the format --option value     |



## EXTRA COMFYUI ARGUMENTS




## BIND

To have persistence you can bind the following folders:

| Container path            |  Description                                        |
| :----------------         | :--------------------                               |
| /app/ComfyUI/models       | Models you are going to dowload or you already have |
| /app/ComfyUI/custom_nodes | Persistence of custom nodes                         |
| /app/ComfyUI/ouput        | Output generated by ComfyUI                         |
| /app/ComfyUI/input	      | Input for Comfyui (reference images etc)            |
| /app/ComfyUI/user         | Settings and worflow                                |

The image create also a volume for python env. 
If the container stop to work destroy and recreate the container.

## Identify the right image for you:

Latest is currently pointing at the image designed for:

Truenas 25.04.1
CUDA 12.4
Ubuntu 22.04
And can probably run on newer release of Truenas.

If you are not running the latest version of Truenas, run the command:
```
nvidia-smi
```
check the output
```
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 550.142                Driver Version: 550.142        CUDA Version: 12.4     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA GeForce GTX 1070 Ti     Off |   00000000:09:00.0 Off |                  N/A |
|  0%   46C    P2             39W /  180W |     629MiB /   8192MiB |      1%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
```

Indentify the CUDA version in the upper right corner and pull the version for your specific CUDA:

```
tommasopiantanida/comfyui-truenas:cudaxx.xx
```
Where xx.xx is the cuda versione you want for your Truenas Installation (at the moment not available working on it).

You can run container with lower version than HOST.
repository of the images is here : https://hub.docker.com/r/tommasopiantanida/comfyui-truenas

## Known Issues
At the moment the configuration of the listening port isn't working.

## References 

Based on the work of 
https://www.johnaldred.com/running-comfyui-in-docker-on-windows-or-linux/
his repository https://github.com/Kaouthia/ComfyUI-Docker/tree/main

and the work of 
https://github.com/mmartial/ComfyUI-Nvidia-Docker/blob/main/Dockerfile/ubuntu24_cuda12.9.Dockerfile


